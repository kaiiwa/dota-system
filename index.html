<!DOCTYPE html>
<html lang="ru">
<head>
    <meta charset="UTF-8">
    <title>DOTA 2 // SYSTEM</title>
    <!-- ICON: Closed Eye (System Style) -->
    <link rel="icon" href="data:image/svg+xml,%3Csvg xmlns='http://www.w3.org/2000/svg' viewBox='0 0 24 24' fill='none' stroke='%23c2c2b0' stroke-width='2' stroke-linecap='round' stroke-linejoin='round'%3E%3Cpath d='M17.94 17.94A10.07 10.07 0 0 1 12 20c-7 0-11-8-11-8a18.45 18.45 0 0 1 5.06-5.94M9.9 4.24A9.12 9.12 0 0 1 12 4c7 0 11 8 11 8a18.5 18.5 0 0 1-2.16 3.19m-6.72-1.07a3 3 0 1 1-4.24-4.24'%3E%3C/path%3E%3Cline x1='1' y1='1' x2='23' y2='23'%3E%3C/line%3E%3C/svg%3E">
    <style>
        @import url('https://fonts.googleapis.com/css2?family=Space+Mono:wght@400;700&family=Tenor+Sans&display=swap');

        :root {
            --bg: #121210;
            --panel: #1a1a18;
            --text: #c2c2b0;
            --dim: #5c5c50;
            --accent: #918e7e;
            --border: #3d3d38;
            --highlight: #e6e3d5;
            --red: #E83030;
        }

        body {
            background: var(--bg);
            color: var(--text);
            font-family: 'Tenor Sans', sans-serif;
            margin: 0; padding: 0;
            background-image: url('https://www.transparenttextures.com/patterns/dark-leather.png');
            min-height: 100vh;
            overflow-x: hidden;
        }

        /* --- AMBIENT VISUALIZER --- */
        .ambient-box {
            position: fixed; bottom: 60px; left: 40px;
            display: flex; align-items: center; gap: 15px;
            cursor: pointer; z-index: 1000;
            background: rgba(0,0,0,0.6); padding: 12px 20px; 
            border: 1px solid var(--border);
            transition: 0.3s;
        }
        .ambient-box:hover { border-color: var(--text); background: rgba(0,0,0,0.8); }
        
        .bars-wrapper { display: flex; gap: 4px; align-items: flex-end; height: 20px; }
        .eq-bar { 
            width: 4px; background: var(--dim); height: 2px; 
            transition: height 0.5s ease, background 0.3s ease; 
        }
        .playing .eq-bar { background: var(--highlight); animation: eq-anim 1s infinite ease-in-out; }
        .playing .eq-bar:nth-child(2) { animation-delay: 0.1s; }
        .playing .eq-bar:nth-child(3) { animation-delay: 0.2s; }
        @keyframes eq-anim { 0%, 100% { height: 4px; } 50% { height: 20px; } }

        /* --- HEADER --- */
        header {
            padding: 50px 5%;
            border-bottom: 1px solid var(--border);
            display: flex; justify-content: space-between; align-items: center;
            background: rgba(18,18,16,0.95);
            position: sticky; top: 0; z-index: 500;
            backdrop-filter: blur(10px);
        }

        h1 { font-size: 28px; letter-spacing: 10px; text-transform: uppercase; margin: 0; color: var(--highlight); }

        .lang-switch button {
            background: transparent; border: 1px solid var(--dim);
            color: var(--dim); padding: 8px 20px; cursor: pointer;
            font-family: 'Space Mono'; font-size: 12px;
            transition: all 0.4s ease;
        }
        .lang-switch button.active { color: var(--bg); background: var(--text); border-color: var(--text); }

        .container { max-width: 1600px; margin: 0 auto; padding: 60px 40px; padding-bottom: 120px; }

        /* --- GRID --- */
        .grid { 
            display: grid; grid-template-columns: repeat(auto-fit, minmax(400px, 1fr)); 
            gap: 1px; background: var(--border); border: 1px solid var(--border);
        }

        .section { background: var(--panel); padding: 35px; height: 100%; box-sizing: border-box; }
        
        .section h2 { 
            font-size: 14px; letter-spacing: 4px; color: var(--dim); 
            border-bottom: 1px solid var(--border); padding-bottom: 15px; margin-bottom: 25px;
            font-family: 'Space Mono'; text-transform: uppercase; margin-top: 0;
        }

        .row {
            display: flex; justify-content: space-between; align-items: center;
            margin-bottom: 12px; padding: 5px 0; 
            border-bottom: 1px solid rgba(255,255,255,0.03);
            transition: 0.2s; cursor: pointer;
            user-select: none;
        }
        .row:hover { background: rgba(255,255,255,0.04); padding-left: 10px; padding-right: 10px; }
        .row:active { background: rgba(255,255,255,0.08); }

        .label { 
            font-family: 'Space Mono', monospace; font-size: 12px; 
            color: var(--accent); width: 85%; 
        }
        .row:hover .label { color: var(--highlight); }

        /* --- CONTROLS --- */
        input[type="checkbox"] {
            appearance: none; width: 16px; height: 16px; border: 1px solid var(--dim);
            cursor: pointer; transition: 0.2s; flex-shrink: 0;
            position: relative;
        }
        input[type="checkbox"]:checked { background: var(--text); border-color: var(--text); }
        
        input[type="color"] { background: none; border: 1px solid var(--border); width: 40px; height: 25px; cursor: pointer; }
        select {
            background: var(--bg); border: 1px solid var(--border); color: var(--text);
            font-family: 'Space Mono'; font-size: 12px; padding: 5px 10px; cursor: pointer;
        }

        /* --- CUSTOM PANEL --- */
        .custom-panel {
            background: var(--panel); border: 1px solid var(--border); border-top: none;
            padding: 40px; display: flex; gap: 60px; 
            align-items: center; justify-content: center; flex-wrap: wrap;
        }
        .custom-item { text-align: center; display: flex; flex-direction: column; align-items: center; gap: 10px; }

        .main-btn {
            display: block; width: 100%; padding: 30px; 
            background: var(--text); color: var(--bg);
            border: none; font-size: 16px; letter-spacing: 8px; 
            cursor: pointer; margin-top: 50px; font-weight: bold;
            transition: 0.3s; text-transform: uppercase;
            font-family: 'Space Mono';
        }
        .main-btn:hover { background: var(--highlight); letter-spacing: 12px; }

        /* --- FOOTER (CREDITS) --- */
        .credits-bar {
            position: fixed; bottom: 20px; left: 50%; transform: translateX(-50%);
            background: rgba(0,0,0,0.8); border: 1px solid var(--dim);
            padding: 10px 25px; border-radius: 50px;
            font-family: 'Space Mono'; font-size: 11px; color: var(--dim);
            z-index: 1500; backdrop-filter: blur(5px);
            display: flex; gap: 5px; align-items: center;
        }
        .credit-link {
            color: var(--text); cursor: pointer; text-decoration: none;
            transition: 0.2s; border-bottom: 1px solid transparent;
        }
        .credit-link:hover { color: var(--highlight); border-bottom-color: var(--highlight); }

        /* --- MODAL --- */
        #modal, #help-modal {
            position: fixed; top: 0; left: 0; width: 100%; height: 100%;
            background: rgba(10,10,8,0.98); display: none; 
            justify-content: center; align-items: center; z-index: 2000;
            opacity: 0; transition: opacity 0.3s;
        }
        #modal.visible, #help-modal.visible { opacity: 1; }
        
        .modal-box {
            background: var(--panel); padding: 50px; border: 1px solid var(--text);
            max-width: 800px; width: 90%; position: relative;
        }
        .code-box {
            background: #000; padding: 20px; font-family: 'Space Mono';
            font-size: 12px; margin: 25px 0; border-left: 3px solid var(--text); color: var(--text);
            overflow-x: auto; white-space: pre-wrap;
        }
        
        .help-btn {
            background: transparent; border: 1px solid var(--dim); color: var(--dim);
            width: 24px; height: 24px; border-radius: 50%; cursor: pointer;
            font-family: 'Space Mono'; font-size: 12px; margin-left: 10px;
            display: inline-flex; align-items: center; justify-content: center;
            transition: 0.2s;
        }
        .help-btn:hover { color: var(--highlight); border-color: var(--highlight); }

        .path-list {
            list-style: none; padding: 0; margin: 0;
            font-family: 'Space Mono'; font-size: 11px; color: var(--dim);
        }
        .path-list li { margin-bottom: 10px; border-bottom: 1px solid rgba(255,255,255,0.1); padding-bottom: 5px; }
        .path-list li:last-child { border: none; }

        /* Tooltip */
        .tooltip {
            position: fixed; background: #050505; color: #fff; padding: 12px;
            border: 1px solid var(--dim); font-family: 'Space Mono'; font-size: 11px;
            z-index: 9999; pointer-events: none; opacity: 0; transition: opacity 0.2s;
            white-space: nowrap; box-shadow: 0 5px 20px rgba(0,0,0,0.5);
        }
    </style>
</head>
<body>

<div class="ambient-box" id="ambient-btn" onclick="toggleAmbient()">
    <div class="bars-wrapper">
        <div class="eq-bar"></div><div class="eq-bar"></div><div class="eq-bar"></div>
    </div>
    <span id="t-ambient" class="translatable" data-key="amb" style="font-size: 11px; font-family: 'Space Mono'; letter-spacing: 1px;">AMBIENT // OFF</span>
</div>

<div id="tooltip" class="tooltip"></div>

<header>
    <h1>DOTA 2 // SYSTEM</h1>
    <div class="lang-switch">
        <button id="l-ru" onclick="setLang('ru')" class="active">RU</button>
        <button id="l-en" onclick="setLang('en')">EN</button>
    </div>
</header>

<div class="container">
    <div class="grid" id="main-grid"></div>

    <div class="custom-panel">
        <div class="custom-item">
            <div class="label translatable" data-key="friendly" data-tip="dota_friendly_color">FRIENDLY COLOR</div>
            <input type="color" id="f-color" value="#5b7c99">
        </div>
        <div class="custom-item">
            <div class="label translatable" data-key="enemy" data-tip="dota_enemy_color">ENEMY COLOR</div>
            <input type="color" id="e-color" value="#E83030">
        </div>
        <div class="custom-item">
            <div class="label translatable" data-key="threads" data-tip="-threads">CPU THREADS</div>
            <select id="threads">
                <option value="0">DEFAULT</option>
                <option value="2">2 CORES</option>
                <option value="4">4 CORES</option>
                <option value="6">6 CORES</option>
                <option value="8">8 CORES</option>
            </select>
        </div>
    </div>

    <button class="main-btn translatable" data-key="gen" onclick="generate()" id="t-gen">DOWNLOAD SETTINGS</button>
</div>

<div class="credits-bar">
    made by <span class="credit-link" data-tip="Telegram" onclick="window.open('https://t.me/kaiiwa')">@kaiiwa</span> 
    to <span class="credit-link" data-tip="Discord" onclick="window.open('https://t.me/kaiiwa')">Dota Fold</span>
</div>

<!-- MAIN MODAL -->
<div id="modal">
    <div class="modal-box">
        <h2 id="t-m-ready" class="translatable" data-key="ready" style="margin-top:0; color: var(--highlight); letter-spacing: 4px;">CONFIGURATION COMPILED</h2>
        <p>
            <span id="t-m-p1" class="translatable" data-key="m1">1. Save file to: dota/cfg/autoexec.cfg</span>
            <button class="help-btn" onclick="toggleHelp()">?</button>
        </p>
        <p id="t-m-p2" class="translatable" data-key="m2">2. Steam Launch Options:</p>
        <div class="code-box" id="launch-out"></div>
        <button class="main-btn translatable" data-key="close" onclick="closeModal()" style="margin-top:30px; padding:20px;">CLOSE</button>
    </div>
</div>

<!-- HELP MODAL -->
<div id="help-modal">
    <div class="modal-box" style="max-width: 600px;">
        <h2 class="translatable" data-key="paths" style="margin-top:0; color: var(--highlight);">COMMON PATHS</h2>
        <ul class="path-list">
            <li>C:\Program Files (x86)\Steam\steamapps\common\dota 2 beta\game\dota\cfg</li>
            <li>C:\Steam\steamapps\common\dota 2 beta\game\dota\cfg</li>
            <li>D:\SteamLibrary\steamapps\common\dota 2 beta\game\dota\cfg</li>
            <li>E:\Games\Steam\steamapps\common\dota 2 beta\game\dota\cfg</li>
            <li>~/.local/share/Steam/steamapps/common/dota 2 beta/game/dota/cfg (Linux)</li>
            <li>~/Library/Application Support/Steam/steamapps/common/dota 2 beta/game/dota/cfg (Mac)</li>
        </ul>
        <button class="main-btn translatable" data-key="back" onclick="toggleHelp()" style="margin-top:30px; padding:20px;">BACK</button>
    </div>
</div>

<script>
    const state = { lang: 'ru' };

    const uiText = {
        amb: { ru: "AMBIENT // ", en: "AMBIENT // " },
        gen: { ru: "СКАЧАТЬ НАСТРОЙКИ", en: "DOWNLOAD SETTINGS" },
        ready: { ru: "ОПЕРАЦИЯ ЗАВЕРШЕНА", en: "SEQUENCE COMPLETE" },
        m1: { ru: "1. Сохраните файл в: dota/cfg/autoexec.cfg", en: "1. Save file to: dota/cfg/autoexec.cfg" },
        m2: { ru: "2. Параметры запуска в Steam:", en: "2. Steam Launch Options:" },
        close: { ru: "ЗАКРЫТЬ", en: "CLOSE" },
        back: { ru: "НАЗАД", en: "BACK" },
        paths: { ru: "ПУТИ К ПАПКЕ CFG", en: "COMMON CFG PATHS" },
        friendly: { ru: "ЦВЕТ СОЮЗНИКОВ", en: "FRIENDLY COLOR" },
        enemy: { ru: "ЦВЕТ ВРАГОВ", en: "ENEMY COLOR" },
        threads: { ru: "ЯДРА CPU", en: "CPU THREADS" }
    };

    const categories = {
        launch: {
            title: {ru: "Параметры запуска", en: "Launch Options"},
            items: [
                { cmd: "-novid", val: "1", def: true, ru: "Убрать заставку", en: "Skip Intro Video" },
                { cmd: "-high", val: "1", def: true, ru: "Высокий приоритет CPU", en: "High CPU Priority" },
                { cmd: "-nod3d9ex", val: "1", def: true, ru: "Быстрый Alt-Tab", en: "Fast Alt-Tab" },
                { cmd: "-map dota", val: "1", def: true, ru: "Предзагрузка карты", en: "Preload Map" },
                { cmd: "-novr", val: "1", def: true, ru: "Отключение VR", en: "Disable VR" },
                { cmd: "con_enable", val: "1", def: true, ru: "Включить консоль", en: "Enable Console" }
            ]
        },
        violence: {
            title: {ru: "Цензура", en: "Violence"},
            items: [
                { cmd: "violence_hblood", val: "0", def: true, ru: "Отключить кровь", en: "Disable Blood" },
                { cmd: "violence_hgibs", val: "0", def: false, ru: "Отключить части тел", en: "Disable Gibs" },
                { cmd: "violence_ablood", val: "0", def: false, ru: "Отключить кровь (Alien)", en: "Disable Alien Blood" },
                { cmd: "violence_agibs", val: "0", def: false, ru: "Отключить части (Alien)", en: "Disable Alien Gibs" }
            ]
        },
        interface: {
            title: {ru: "Система", en: "System"},
            items: [
                { cmd: "panorama_allow_transitions", val: "0", def: true, ru: "Отключить анимации меню", en: "Disable Menu Animations" },
                { cmd: "dota_portrait_animate", val: "0", def: false, ru: "Отключить анимацию портрета", en: "Disable Portrait Animation" },
                { cmd: "map_enable_portrait_worlds", val: "1", def: false, ru: "Включить фон портрета", en: "Enable Portrait Worlds" },
                { cmd: "fps_max", val: "0", def: true, ru: "Разблокировать FPS", en: "Unlock FPS" },
                { cmd: "engine_enable_frametime_warnings", val: "0", def: false, ru: "Скрыть ошибки кадров", en: "Hide Frame Warnings" },
                { cmd: "dota_sf_hud_disable_fade", val: "1", def: false, ru: "Отключить затухание HUD", en: "Disable HUD Fade" },
                { cmd: "r_dashboard_render_quality", val: "0", def: false, ru: "Снизить качество меню", en: "Low Quality Dashboard" },
                { cmd: "dota_hero_auto_graball", val: "1", def: false, ru: "Авто-сбор тайника", en: "Auto Stash Grab" },
                { cmd: "dota_selection_groups", val: "true", def: false, ru: "Группы выбора", en: "Selection Groups" },
                { cmd: "dota_defer_panorama_on_sim_ticks", val: "0", def: false, ru: "Ускорить Panorama", en: "Defer Panorama" },
                { cmd: "r_draw_selected_ring", val: "0", def: true, ru: "Убрать кольцо выбора", en: "Disable Selection Ring" },
                { cmd: "r_experimental_lag_limiter", val: "0", def: true, ru: "Откл. лимитер лагов", en: "Disable Lag Limiter" },
                { cmd: "dota_unit_use_player_color", val: "1", def: true, ru: "Использовать цвета игроков", en: "Use Player Colors" }
            ]
        },
        particles: {
            title: {ru: "Частицы", en: "Particles"},
            items: [
                { cmd: "r_dota_disable_weather_particles", val: "1", def: true, ru: "Отключить погоду", en: "Disable Weather" },
                { cmd: "cl_particle_fallback_base", val: "4", def: false, ru: "Снизить качество частиц", en: "Reduce Particle Quality" },
                { cmd: "cl_particle_fallback_multiplier", val: "4", def: false, ru: "Упростить дальние частицы", en: "Simplify Distant Particles" },
                { cmd: "cl_particle_sim_fallback_base_multiplier", val: "5", def: false, ru: "Множитель симуляции", en: "Sim Fallback Multiplier" },
                { cmd: "cl_particle_sim_fallback_threshold_ms", val: "2.5", def: false, ru: "Порог симуляции (ms)", en: "Sim Threshold (ms)" },
                { cmd: "cl_aggregate_particles", val: "1", def: false, ru: "Группировать частицы", en: "Aggregate Particles" },
                { cmd: "dota_disable_particle_lights", val: "1", def: false, ru: "Отключить свет магии", en: "Disable Spell Lights" },
                { cmd: "dota_building_destruction_effects", val: "0", def: false, ru: "Отключить разрушение зданий", en: "Disable Building Destruction" },
                { cmd: "r_particle_max_detail_level", val: "0", def: false, ru: "Мин. детализация частиц", en: "Min Particle Detail" },
                { cmd: "r_particle_max_texture_layers", val: "2", def: false, ru: "Макс. слоев текстур", en: "Max Texture Layers" },
                { cmd: "r_particle_cables_cast_shadows", val: "0", def: false, ru: "Тени от кабелей/веревок", en: "Cables Cast Shadows" },
                { cmd: "dota_unit_fly_particle", val: "0", def: false, ru: "Отключить частицы полета", en: "Disable Fly Particles" },
                { cmd: "r_dota_bloom_compute_shader", val: "1", def: false, ru: "Bloom Compute Shader", en: "Bloom Compute Shader" },
                { cmd: "dota_allow_clientside_particles", val: "0", def: true, ru: "Откл. клиентские частицы", en: "Disable Client Particles" }
            ]
        },
        world: {
            title: {ru: "Мир и Текстуры", en: "World & Textures"},
            items: [
                { cmd: "dota_ambient_creatures", val: "0", def: true, ru: "Отключить животных", en: "Disable Ambient Creatures" },
                { cmd: "r_grass_quality", val: "0", def: false, ru: "Отключить траву", en: "Disable Grass" },
                { cmd: "dota_cheap_water", val: "1", def: false, ru: "Упростить воду", en: "Simplify Water" },
                { cmd: "r_dota_allow_wind_on_trees", val: "0", def: false, ru: "Отключить ветер", en: "Disable Wind on Trees" },
                { cmd: "r_dota_normal_maps", val: "0", def: false, ru: "Отключить карты нормалей", en: "Disable Normal Maps" },
                { cmd: "r_dota_allow_parallax_mapping", val: "0", def: false, ru: "Отключить параллакс", en: "Disable Parallax" },
                { cmd: "r_deferred_height_fog", val: "0", def: false, ru: "Отключить туман", en: "Disable Fog" },
                { cmd: "r_dota_render_2d_skybox", val: "0", def: false, ru: "Отключить 2D небо", en: "Disable 2D Skybox" },
                { cmd: "dota_ambient_cloth", val: "0", def: false, ru: "Отключить физику ткани", en: "Disable Cloth Physics" },
                { cmd: "r_renderoverlayfragment", val: "0", def: false, ru: "Отключить наложения земли", en: "Disable Ground Overlays" },
                { cmd: "r_texturefilteringquality", val: "0", def: false, ru: "Мин. фильтрация текстур", en: "Min Texture Filtering" },
                { cmd: "r_character_decal_resolution", val: "256", def: false, ru: "Низкое разрешение декалей", en: "Low Decal Resolution" },
                { cmd: "r_decal_cullsize", val: "0", def: false, ru: "Убрать мелкие декали", en: "Cull Small Decals" },
                { cmd: "sc_clutter_density_full_size", val: "0.04", def: false, ru: "Снизить плотность мусора", en: "Reduce Clutter Density" },
                { cmd: "r_depth_of_field", val: "0", def: true, ru: "Отключить глубину резкости", en: "Disable Depth of Field" },
                { cmd: "r_dota_fxaa", val: "1", def: true, ru: "Включить FXAA", en: "Enable FXAA" }
            ]
        },
        shadows: {
            title: {ru: "Освещение и Тени", en: "Lighting & Shadows"},
            items: [
                { cmd: "r_dynamiclighting", val: "0", def: false, ru: "Отключить динамический свет", en: "Disable Dynamic Lighting" },
                { cmd: "r_dota_local_light_compute", val: "0", def: false, ru: "Отключить локальный свет", en: "Disable Local Light Compute" },
                { cmd: "r_dota_color_correction", val: "0", def: false, ru: "Отключить цветокоррекцию", en: "Disable Color Correction" },
                { cmd: "r_ssao", val: "0", def: false, ru: "Отключить SSAO", en: "Disable Ambient Occlusion" },
                { cmd: "r_deferred_additive_pass", val: "0", def: false, ru: "Отключить аддитивный свет", en: "Disable Additive Pass" },
                { cmd: "r_deferred_simple_light", val: "0", def: false, ru: "Отключить простое освещение", en: "Disable Simple Light" },
                { cmd: "r_deferred_specular", val: "0", def: false, ru: "Отключить отражения", en: "Disable Specular" },
                { cmd: "r_deferred_specular_bloom", val: "0", def: false, ru: "Отключить свечение (Bloom)", en: "Disable Specular Bloom" },
                { cmd: "cl_globallight_shadow_mode", val: "0", def: false, ru: "Отключить глобальные тени", en: "Disable Global Shadows" },
                { cmd: "r_dota_shadow_ambient_light", val: "0", def: false, ru: "Отключить свет теней", en: "Disable Shadow Ambient" },
                { cmd: "r_dota_allow_spotlight_shadows", val: "0", def: false, ru: "Отключить тени прожекторов", en: "Disable Spotlight Shadows" },
                { cmd: "csm_viewmodel_shadows", val: "0", def: false, ru: "Отключить тени героя", en: "Disable Viewmodel Shadows" },
                { cmd: "r_light_flickering_enabled", val: "0", def: false, ru: "Отключить мерцание света", en: "Disable Light Flickering" },
                { cmd: "cl_retire_low_priority_lights", val: "1", def: false, ru: "Удалять слабый свет", en: "Remove Low Prio Lights" },
                { cmd: "r_dota_allow_desaturate_layers", val: "0", def: false, ru: "Отключить десатурацию", en: "Disable Desaturate Layers" },
                { cmd: "sc_shadow_depth_bias", val: "64", def: false, ru: "Смещение глубины теней", en: "Shadow Depth Bias" },
                { cmd: "lb_shadow_texture_height_override", val: "128", def: true, ru: "Мин. высота теней", en: "Min Shadow Height" },
                { cmd: "lb_shadow_texture_width_override", val: "128", def: true, ru: "Мин. ширина теней", en: "Min Shadow Width" },
                { cmd: "lb_dynamic_shadow_resolution_base", val: "128", def: true, ru: "Разрешение дин. теней", en: "Dyn Shadow Res" },
                { cmd: "lb_dynamic_shadow_resolution_delay", val: "3", def: true, ru: "Задержка теней", en: "Shadow Delay" },
                { cmd: "r_dota_spotlight_shadows_resolution", val: "128", def: true, ru: "Разрешение прожекторов", en: "Spotlight Res" },
                { cmd: "r_aoproxy_cull_dist", val: "4", def: true, ru: "Дальность AO", en: "AO Cull Dist" },
                { cmd: "r_aoproxy_min_dist", val: "3", def: true, ru: "Мин. дальность AO", en: "AO Min Dist" }
            ]
        }
    };

    // --- PRESET LOGIC (HASH) ---
    const hash = window.location.hash;
    Object.values(categories).forEach(cat => {
        cat.items.forEach(item => {
            if (hash === '#all') item.def = true;
            else if (hash === '#none') item.def = false;
        });
    });

    function animateText(element, newText) {
        const oldText = element.innerText;
        const length = Math.max(oldText.length, newText.length);
        let step = 0;
        if (element.dataset.animInterval) clearInterval(element.dataset.animInterval);

        const interval = setInterval(() => {
            let result = "";
            for (let i = 0; i < length; i++) {
                if (i < step) result += newText[i] || "";
                else result += oldText[i] || "";
            }
            element.innerText = result;
            step++;
            if (step > length) clearInterval(interval);
        }, 20);

        element.dataset.animInterval = interval;
    }

    function setLang(l) {
        state.lang = l;
        document.querySelectorAll('.lang-switch button').forEach(b => b.classList.remove('active'));
        document.getElementById(`l-${l}`).classList.add('active');

        // Animate UI elements
        document.querySelectorAll('.translatable').forEach(el => {
            const key = el.dataset.key;
            if (uiText[key]) {
                let text = uiText[key][l];
                if (key === 'amb') {
                    const status = document.getElementById('ambient-btn').classList.contains('playing') ? "ON" : "OFF";
                    text += status;
                }
                animateText(el, text);
            }
        });

        // Animate Section Headers
        document.querySelectorAll('.section h2').forEach(h2 => {
            const catKey = h2.dataset.cat;
            if (categories[catKey]) animateText(h2, categories[catKey].title[l]);
        });

        // Animate Grid Items (Labels) without re-rendering
        document.querySelectorAll('.grid .label').forEach(lbl => {
            const cmd = lbl.dataset.rawCmd; 
            for (const cat in categories) {
                const item = categories[cat].items.find(i => i.cmd === cmd);
                if (item) {
                    animateText(lbl, item[l]);
                    break;
                }
            }
        });
    }

    function toggleRow(row) {
        const checkbox = row.querySelector('input[type="checkbox"]');
        checkbox.checked = !checkbox.checked;
    }

    // Initial Render (Only called once)
    function render() {
        const grid = document.getElementById('main-grid');
        grid.innerHTML = '';

        Object.keys(categories).forEach(key => {
            const cat = categories[key];
            let html = `<div class="section"><h2 data-cat="${key}">${cat.title[state.lang]}</h2>`;
            cat.items.forEach(item => {
                const tip = `${item.cmd} ${item.val}`;
                html += `
                    <div class="row" onclick="toggleRow(this)">
                        <span class="label" data-tip="${tip}" data-raw-cmd="${item.cmd}">${state.lang === 'ru' ? item.ru : item.en}</span>
                        <input type="checkbox" data-cmd="${item.cmd}" data-val="${item.val}" ${item.def ? 'checked' : ''} onclick="event.stopPropagation()">
                    </div>
                `;
            });
            html += `</div>`;
            grid.innerHTML += html;
        });
    }

    const tooltip = document.getElementById('tooltip');
    document.addEventListener('mouseover', (e) => {
        if(e.target.classList.contains('label') || e.target.classList.contains('credit-link') || e.target.closest('.custom-item')) {
            let tip = e.target.getAttribute('data-tip');
            if(!tip && e.target.closest('.custom-item')) {
                tip = e.target.closest('.custom-item').querySelector('.label').getAttribute('data-tip');
            }
            
            if (tip) {
                tooltip.innerHTML = tip;
                tooltip.style.opacity = 1;
            }
        }
    });
    document.addEventListener('mousemove', (e) => {
        tooltip.style.left = e.clientX + 15 + 'px';
        tooltip.style.top = e.clientY + 15 + 'px';
    });
    document.addEventListener('mouseout', (e) => {
        tooltip.style.opacity = 0;
    });

    function generate() {
        let cfg = `// GENERATED BY DOTA SYSTEM TOOL\n`;
        let launch = `-language ${state.lang === 'ru' ? 'russian' : 'english'} `;

        document.querySelectorAll('input[type="checkbox"]:checked').forEach(i => {
            const cmd = i.dataset.cmd;
            const val = i.dataset.val;
            if(cmd.startsWith('-')) launch += `${cmd} `;
            else cfg += `${cmd} ${val};\n`;
        });

        const hexToRgb = hex => {
            const r = parseInt(hex.slice(1,3), 16);
            const g = parseInt(hex.slice(3,5), 16);
            const b = parseInt(hex.slice(5,7), 16);
            return `${r} ${g} ${b}`;
        };
        cfg += `dota_friendly_color ${hexToRgb(document.getElementById('f-color').value)};\n`;
        cfg += `dota_enemy_color ${hexToRgb(document.getElementById('e-color').value)};\n`;

        const thr = document.getElementById('threads').value;
        if(thr !== "0") launch += `-threads ${thr} `;

        launch += "+exec autoexec.cfg";

        const blob = new Blob([cfg], {type: 'text/plain'});
        const a = document.createElement('a');
        a.href = URL.createObjectURL(blob);
        a.download = "autoexec.cfg";
        a.click();

        document.getElementById('launch-out').innerText = launch;
        const modal = document.getElementById('modal');
        modal.style.display = 'flex';
        setTimeout(() => modal.classList.add('visible'), 10);
    }

    function closeModal() {
        const modal = document.getElementById('modal');
        modal.classList.remove('visible');
        setTimeout(() => modal.style.display = 'none', 300);
    }

    function toggleHelp() {
        const help = document.getElementById('help-modal');
        
        if (help.style.display === 'flex') {
            help.classList.remove('visible');
            setTimeout(() => help.style.display = 'none', 300);
        } else {
            help.style.display = 'flex';
            setTimeout(() => help.classList.add('visible'), 10);
        }
    }

    let ctx, isAmb = false, interval;
    function toggleAmbient() {
        const btn = document.getElementById('ambient-btn');
        const txt = document.getElementById('t-ambient');
        
        if(!ctx) ctx = new (window.AudioContext || window.webkitAudioContext)();
        
        if(!isAmb) {
            ctx.resume();
            btn.classList.add('playing');
            animateText(txt, uiText.amb[state.lang] + "ON");
            startArp();
        } else {
            ctx.suspend();
            btn.classList.remove('playing');
            animateText(txt, uiText.amb[state.lang] + "OFF");
            clearInterval(interval);
        }
        isAmb = !isAmb;
    }

    function startArp() {
        const drone = ctx.createOscillator();
        const dGain = ctx.createGain();
        drone.frequency.value = 55; 
        drone.type = 'triangle';
        dGain.gain.value = 0.05;
        drone.connect(dGain); dGain.connect(ctx.destination);
        drone.start();

        const scale = [220, 261.63, 329.63, 392.00, 440]; 
        interval = setInterval(() => {
            const osc = ctx.createOscillator();
            const g = ctx.createGain();
            const note = scale[Math.floor(Math.random() * scale.length)];
            osc.frequency.value = note; osc.type = 'sine';
            g.gain.setValueAtTime(0, ctx.currentTime);
            g.gain.linearRampToValueAtTime(0.02, ctx.currentTime + 0.1);
            g.gain.exponentialRampToValueAtTime(0.0001, ctx.currentTime + 3);
            osc.connect(g); g.connect(ctx.destination);
            osc.start(); osc.stop(ctx.currentTime + 3);
        }, 800);
    }

    // 1. Render the grid once
    render();
    // 2. Force language text update (to ensure everything is in RU and animated initially)
    setLang('ru');
</script>
</body>
</html>
